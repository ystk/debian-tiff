Backport of 0abd094b6e5079c4d8be733829240491cb230f3d

--- a/libtiff/tif_dirwrite.c
+++ b/libtiff/tif_dirwrite.c
@@ -2182,9 +2182,13 @@ TIFFWriteDirectoryTagCheckedRational(TIF
 {
 	static const char module[] = "TIFFWriteDirectoryTagCheckedRational";
 	uint32 m[2];
-	assert(value>=0.0);
 	assert(sizeof(uint32)==4);
-	if (value<=0.0)
+        if( value < 0 )
+        {
+            TIFFErrorExt(tif->tif_clientdata,module,"Negative value is illegal");
+            return 0;
+        }
+	else if (value==0.0)
 	{
 		m[0]=0;
 		m[1]=1;
--- a/tools/tiffcrop.c
+++ b/tools/tiffcrop.c
@@ -7941,7 +7941,6 @@ writeCroppedImage(TIFF *in, TIFF *out, s
   if (!TIFFWriteDirectory(out))
     {
     TIFFError("","Failed to write IFD for page number %d", pagenum);
-    TIFFClose(out);
     return (-1);
     }
 
