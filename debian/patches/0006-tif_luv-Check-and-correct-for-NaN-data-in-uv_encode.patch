From 7016c139a340a365daf493d9a8af79cc590b8c3f Mon Sep 17 00:00:00 2001
From: Su_Laus <sulau@freenet.de>
Date: Thu, 16 Feb 2023 12:03:16 +0100
Subject: tif_luv: Check and correct for NaN data in uv_encode().

Closes #530

See merge request !473
---
 libtiff/tif_luv.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/libtiff/tif_luv.c b/libtiff/tif_luv.c
index 80ed0163..3065d2a8 100644
--- a/libtiff/tif_luv.c
+++ b/libtiff/tif_luv.c
@@ -896,6 +896,13 @@ uv_encode(double u, double v, int em)	/* encode (u',v') coordinates */
 {
 	register int	vi, ui;
 
+	/* check for NaN */
+	if (u != u || v != v)
+	{
+ 		u = U_NEU;
+		v = V_NEU;
+	}
+
 	if (v < UV_VSTART)
 		return oog_encode(u, v);
 	vi = itrunc((v - UV_VSTART)*(1./UV_SQSIZ), em);
-- 
2.30.2

